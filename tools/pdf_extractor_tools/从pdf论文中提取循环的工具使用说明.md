# 从pdf论文中提取循环的工具使用说明

## 使用步骤概述
首先使用pdf_loop_extractor尝试直接提取，未提取出循环的论文，或者提取出的循环质量不高的论文，再尝试使用图片方法提取。
图片方法：第一步使用picture_extract_word提取成txt文件，第二步使用txt_loop_extractor提取循环。第一步也可以替换成先使用picture_change将pdf转为图片，再使用YBMXautoDownload将图片文字提取存入txt文件。
各文件使用方法详见下方说明。

## 直接提取方法：pdf_loop_extractor使用说明
### 程序功能：
给定一个装有pdf文件的文件夹，程序将在store_path指定的文件夹中创建以各pdf文件名为名的文件夹，将提取出的循环分别保存到对应的文件夹中。
提取出的循环分为两类：
一类是“完整”提取的循环，这些循环将被存入“right"文件夹中；
一类是循环头提取成功但循环体提取失败的循环，这些循环将被存入”wrong"文件夹中。
循环文件的命名为PxNy，x是循环在pdf文件中的页数，y是循环在该页中的序数。
该程序会获取所有未能提取出循环的论文的名字并打印出来，这部分论文应用图片方法尝试提取。

### 库要求：
os 和 pdfplumber

### 基础使用方法：
直接打开文件。
将需要提取循环的pdf文件都放入一个文件夹中，在dir_path处（204行）填入此文件夹的地址。
另外创建一个存储循环的文件夹，在store_path处（205行）填入此文件夹的地址。
这两个文件夹位置没有要求。
填入并确认准确后，直接运行即可。

### 可调节参数：
tol_y：在第250行，是行提取时两个word-like-thing在竖直方向上的差异的容忍度，过小会使字符更容易被认为在不同行，可能造成单行被拆解成不同行的情况，打乱提取；过大则可能造成不同行字符被识别在同一行的情况，打乱提取。

### 已知的程序局限性：
1. “/*xxx*/” 暂时无法检测，这种注释语句跟随在指令语句后或者跨行，提取可能会失
败。
2. 论文中存在括号缺失、分号缺失或特殊字符等问题的，循环语法可能不正确，也可能提取到非循环体的内容，但仍可能提取到right文件夹中
3. 存在行识别不精准的情况，有些字符在不同行但是会被识别进同一行，有些字符在同一行但是会被拆开
4. 存在字符识别不精准的情况，有些字符可能被识别成其它字符

## 图像提取方法使用说明

picture_change.py 可以将pdf的每一页生成对应的png格式图片并以images_x的形式命名（x代表页码，从零开始）。
YBMXautoDownload.py是通用的文字识别，可以把png图片转化成txt文档。
picture_extract_word.py是图像文字识别的主文档，可以将pdf每一页转化为png后进行分栏文字识别，并以同样命名的txt放回原路径。同时在每读取新的一页pdf的时候，会以“---------The new page is: x---------"（其中x是页码数，从0开始）分隔。

### 使用方法：
1. 在第33行修改为pdf的地址；
2. 在第36行修改为转化图片后生成的文件夹；
3. 在第39行可通过更改lang参数（如ch、en、fr、german、japan）实现多种语言识别。

**paddleocr使用时可能与一些库的版本会冲突**，建议新建一个虚拟环境来专门运行。
参考网址：
https://zhuanlan.zhihu.com/p/609496068
https://www.paddlepaddle.org.cn/install/quick?docurl=/documentation/docs/zh/install/pip/macos-pip.html
https://github.com/PaddlePaddle/PaddleOCR

### 目前存在的问题：
1. 图片文字识别代码在提取for循环时，对于单独成行的大括号会出现无识别的情况；我们试图提高pdf转图片时的图片分辨率，解决了一部分问题但是并未完全解决。
2. 提取文本中若出现类似于希腊字母、数学符合等特殊字符，paddleocr库可能因为识别语言限制而会识别为别的符号；
3. 提取文本时如遇到类似于下标套下标的情况，由于符号太小，最低级下标会识别不出；
4. 遇到图片中表格时，因为代码仅为文字提取，仅会提取表格中的文字，并不会提取图像（目前来看对循环的提取影响不大）；
5. 遇到代码前有行数标明，因为该数字在文字识别中存在坐标不明确的情况（具体见paddleocr原理），所以会干扰文字的分栏识别。

## txt_loop_extractor使用说明

### 程序功能：
给定一个装有由图片提取方法生成的txt文件的文件夹，程序将在store_path指定的文件夹中创建以各txt文件名为名的文件夹，将提取出的循环分别保存到对应的文件夹中。
提取出的循环分为两类：
一类是“完整”提取的循环，这些循环将被存入“right"文件夹中；
一类是循环头提取成功但循环体提取失败的循环，这些循环将被存入”wrong"文件夹中。
循环文件的命名为PxNy，x是循环在txt文件对应的pdf文件中的页数，y是循环在该页中的序数。

### 库要求：
os

### 基础使用方法：
直接打开文件。
将需要提取循环的pdf文件都放入一个文件夹中，在dir_path处（203行）填入此文件夹的地址。
另外创建一个存储循环的文件夹，在store_path处（204行）填入此文件夹的地址。
这两个文件夹位置没有要求。
填入并确认准确后，直接运行即可。

### 已知的程序局限性：
1. “/*xxx*/” 暂时无法检测，这种注释语句跟随在指令语句后或者跨行，提取可能会失败。
2. 论文中存在括号缺失、分号缺失或特殊字符等问题的，循环语法可能不正确，也可能提取到非循环体的内容，但仍可能提取到right文件夹中。
3. 提取精度受到txt文件提取精度的制约。